<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>RaidTrack Web UI</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-black text-slate-100">
  <div class="absolute inset-0 bg-[radial-gradient(1000px_600px_at_20%_10%,rgba(56,189,248,0.15),transparent),radial-gradient(800px_500px_at_80%_0%,rgba(147,51,234,0.15),transparent)] pointer-events-none"></div>
  <main class="relative mx-auto max-w-4xl px-6 py-10">
    <header class="flex items-center justify-between gap-4 mb-8">
      <div class="flex items-center gap-3">
        <div class="size-10 rounded-2xl bg-cyan-500/20 border border-cyan-400/30 grid place-items-center">
          <span class="text-cyan-300 font-bold">RT</span>
        </div>
        <h1 class="text-2xl font-semibold">RaidTrack Web UI</h1>
      </div>
      <nav class="flex gap-2">
        <a href="/" class="rounded-xl px-4 py-2 bg-white/10 hover:bg-white/20 border border-white/15 transition">Home</a>
        <a href="/panel" class="rounded-xl px-4 py-2 bg-white/10 hover:bg-white/20 border border-white/15 transition">Panel</a>
      </nav>
    </header>

    <section class="grid gap-6 md:grid-cols-2">
      <div class="backdrop-blur-xl bg-white/5 border border-white/10 shadow-2xl rounded-3xl p-6">
        <h2 class="text-lg font-semibold">Import JSON</h2>
        <p class="text-slate-300 text-sm mt-1">Paste your raid JSON to publish/update on Discord.</p>
        <textarea id="json" class="mt-4 w-full h-44 rounded-xl bg-black/30 border border-white/10 p-3 outline-none focus:border-cyan-400/50" placeholder='{"raidId":"...", ...}'></textarea>
        <div class="mt-4 flex gap-2">
          <input id="guild" class="flex-1 rounded-xl bg-black/30 border border-white/10 p-3 outline-none focus:border-cyan-400/50" placeholder="Guild ID">
          <button id="send" class="rounded-xl px-4 py-2 bg-cyan-500/90 hover:bg-cyan-400 text-black font-medium transition">Send</button>
        </div>
        <p id="resp" class="mt-3 text-sm text-slate-300"></p>
      </div>

      <div class="backdrop-blur-xl bg-white/5 border border-white/10 shadow-2xl rounded-3xl p-6">
        <h2 class="text-lg font-semibold">Quick Links</h2>
        <ul class="mt-3 space-y-2 text-slate-300">
          <li><a class="hover:underline" href="/health">/health</a></li>
          <li><a class="hover:underline" href="/web/">/web/ (this page)</a></li>
          <li><a class="hover:underline" href="/panel">/panel</a></li>
        </ul>
        <p class="text-xs text-slate-500 mt-6">© <span id="year"></span> RaidTrack</p>
      </div>
    </section>
  </main>

  <script>
    // No TypeScript here – plain JS
    document.getElementById('year').textContent = String(new Date().getFullYear());

    const jsonEl = document.getElementById('json');
    const guildEl = document.getElementById('guild');
    const respEl = document.getElementById('resp');
    const sendBtn = document.getElementById('send');

    sendBtn.addEventListener('click', async () => {
      const guildId = (guildEl.value || '').trim();
      const jsonStr = (jsonEl.value || '').trim();
      try {
        const raid = JSON.parse(jsonStr);
        const res = await fetch('/api/ingest', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'x-api-key': '' }, // <-- set your key
          body: JSON.stringify({ guildId, raid })
        });
        const data = await res.json();
        respEl.textContent = res.ok ? 'OK: ' + JSON.stringify(data) : 'Error: ' + (data.error || res.statusText);
      } catch (e) {
        respEl.textContent = 'Invalid JSON or request failed.';
      }
    });
  </script>
</body>
</html>
